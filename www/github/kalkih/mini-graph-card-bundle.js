(function(){"use strict";function a(){const b=E(["\n          <div class=\"info__item\">\n            <span class=\"info__item__type\">","</span>\n            <span class=\"info__item__value\">\n              "," ","\n            </span>\n            <span class=\"info__item__time\">\n              ","\n            </span>\n          </div>\n        "]);return a=function(){return b},b}function b(){const a=E(["\n      <div class=\"info flex\">\n        ","\n      </div>\n    "]);return b=function(){return a},a}function c(){const a=E(["\n      <div class=\"graph__labels flex\">\n        <span class=\"label--max\">","</span>\n        <span class=\"label--min\">","</span>\n      </div>\n    "]);return c=function(){return a},a}function d(){const a=E(["\n      <svg width='100%' height="," viewBox='0 0 500 ","'\n        @click=",">\n        <g>\n          <defs>\n            ","\n          </defs>\n          ","\n          ","\n          ","\n          ","\n        </g>\n        ","\n      </svg>"]);return d=function(){return a},a}function e(){const a=E(["<g class='bars' ?anim=",">","</g>"]);return e=function(){return a},a}function f(){const a=E(["\n        <rect class='bar' x="," y=","\n          height="," width="," fill=","\n          @mouseover=","\n          @mouseout=",">\n          ","\n        </rect>"]);return f=function(){return a},a}function g(){const a=E(["\n          <animate attributeName='y' from="," to="," dur='1s' fill='remove'\n            calcMode='spline' keyTimes='0; 1' keySplines='0.215 0.61 0.355 1'>\n          </animate>"]);return g=function(){return a},a}function h(){const a=E(["\n      <rect id=","\n        fill="," height=\"100%\" width=\"100%\"\n        mask=","\n      />"]);return h=function(){return a},a}function i(){const a=E(["",""]);return i=function(){return a},a}function j(){const a=E(["\n            <stop stop-color="," offset="," />\n          "]);return j=function(){return a},a}function k(){const a=E(["\n        <linearGradient id="," gradientTransform=\"rotate(90)\">\n          ","\n        </linearGradient>"]);return k=function(){return a},a}function l(){const a=E(["\n          <circle\n            class='line--point'\n            stroke=","\n            fill=","\n            cx="," cy="," r=","\n            @mouseover=","\n            @mouseout=","\n          />\n        "]);return l=function(){return a},a}function m(){const a=E(["\n      <g class='line--points'\n        ?init=","\n        anim=","\n        style=\"animation-delay: ","\"\n        fill=","\n        stroke=","\n        stroke-width=",">\n        ","\n      </g>"]);return m=function(){return a},a}function n(){const a=E(["\n      <mask id=",">\n        ","\n      </mask>\n    "]);return n=function(){return a},a}function o(){const a=E(["\n      <path\n        class='line'\n        .id=","\n        anim="," ?init=","\n        style=\"animation-delay: ","\"\n        fill='none'\n        stroke-dasharray="," stroke-dashoffset=","\n        stroke=","\n        stroke-width=","\n        d=","\n      />"]);return o=function(){return a},a}function p(){const a=E(["\n      <defs>\n        <linearGradient id="," x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n          <stop stop-color="," offset='0%' stop-opacity='1'/>\n          <stop stop-color="," offset='100%' stop-opacity='.15'/>\n        </linearGradient>\n      </defs>\n      <path\n        class='line--fill'\n        type=","\n        .id="," anim="," ?init=","\n        style=\"animation-delay: ","\"\n        fill=","\n        stroke=","\n        stroke-width=","\n        d=","\n      />"]);return p=function(){return a},a}function q(){const a=E(["\n      <svg width='10' height='10'>\n        <rect width='10' height='10' fill="," />\n      </svg>\n    "]);return q=function(){return a},a}function r(){const a=E(["\n          <div class=\"graph__legend__item\" @click=",">\n            ","\n            <span class=\"ellipsis\">","</span>\n          </div>\n        "]);return r=function(){return a},a}function s(){const a=E(["\n      <div class=\"graph__legend\">\n        ","\n      </div>\n    "]);return s=function(){return a},a}function t(){const a=E(["\n      <div class=\"graph\">\n        <div class=\"graph__container\">\n          ","\n          <div class=\"graph__container__svg\">\n            ","\n          </div>\n        </div>\n        ","\n      </div>"]);return t=function(){return a},a}function u(){const a=E(["\n      <div class=\"state__time\">\n        <span>","</span> -\n        <span>","</span>\n      </div>\n    "]);return u=function(){return a},a}function v(){const a=E(["\n        <div\n          class=\"state state--small\"\n          style=",">\n          ","\n          <span class=\"state__value ellipsis\">\n            ","\n          </span>\n          <span class=\"state__uom ellipsis\">\n            ","\n          </span>\n        </div>\n      "]);return v=function(){return a},a}function w(){const a=E(["\n        <div class=\"states flex\" loc=",">\n          <div class=\"state\">\n            <span class=\"state__value ellipsis\" style=",">\n              ","\n            </span>\n            <span class=\"state__uom ellipsis\" style=",">\n              ","\n            </span>\n            ","\n          </div>\n          <div class=\"states--secondary\">\n            ","\n          </div>\n          ","\n        </div>\n      "]);return w=function(){return a},a}function x(){const a=E(["\n      <div class=\"name flex\">\n        <span class=\"ellipsis\" style=",">","</span>\n      </div>\n    "]);return x=function(){return a},a}function y(){const a=E(["\n      <div class=\"icon\" loc=","\n        style=",">\n        <ha-icon .icon=","></ha-icon>\n      </div>\n    "]);return y=function(){return a},a}function z(){const a=E(["\n          <div class=\"header flex\" loc="," style=\"font-size: ","px;\">\n            "," ","\n          </div>\n        "]);return z=function(){return a},a}function A(){const a=E(["\n      <ha-card\n        class=\"flex\"\n        ?group=","\n        ?fill=","\n        ?points=","\n        ?labels=","\n        ?gradient=","\n        ?more-info=","\n        style=\"font-size: ","px;\"\n        @click=","\n      >\n        "," "," "," ","\n      </ha-card>\n    "]);return A=function(){return a},a}function B(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){C(a,b,c[b])})}return a}function C(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function D(){const a=E(["\n  :host {\n    display: flex;\n    flex-direction: column;\n  }\n  ha-card {\n    flex-direction: column;\n    flex: 1;\n    padding: 16px 0;\n    position: relative;\n    overflow: hidden;\n  }\n  ha-card > div {\n    padding: 0px 16px 16px 16px;\n  }\n  ha-card > div:last-child {\n    padding-bottom: 0;\n  }\n  ha-card[points] .line--points,\n  ha-card[labels] .graph__labels {\n    opacity: 0;\n    transition: opacity .25s;\n    animation: none;\n  }\n  ha-card[points]:hover .line--points,\n  ha-card:hover .graph__labels {\n    opacity: 1;\n  }\n  ha-card[fill] {\n    padding-bottom: 0;\n  }\n  ha-card[fill] .graph {\n    padding: 0;\n    order: 10;\n  }\n  ha-card[fill] path {\n    stroke-linecap: initial;\n    stroke-linejoin: initial;\n  }\n  ha-card[fill] .graph__legend {\n    order: -1;\n    padding: 0 16px 8px 16px;\n  }\n  ha-card[fill] .info {\n    padding-bottom: 16px;\n  }\n  ha-card[group] {\n    box-shadow: none;\n    padding: 0;\n  }\n  ha-card[group] > div {\n    padding-left: 0;\n    padding-right: 0;\n  }\n  ha-card[group] .graph__legend {\n    padding-left: 0;\n    padding-right: 0;\n  }\n  ha-card[more-info] {\n    cursor: pointer;\n  }\n  .flex {\n    display: flex;\n    display: -webkit-flex;\n    min-width: 0;\n  }\n  .header {\n    justify-content: space-between;\n  }\n  .header[loc=\"center\"] {\n    justify-content: space-around;\n  }\n  .header[loc=\"left\"] {\n    align-self: flex-start;\n  }\n  .header[loc=\"right\"] {\n    align-self: flex-end;\n  }\n  .name {\n    align-items: center;\n    min-width: 0;\n    opacity: .8;\n    letter-spacing: .05em;\n  }\n  .name > span {\n    font-size: 1.2em;\n    font-weight: 400;\n    max-height: 1.4em;\n    min-height: 1.4em;\n    opacity: .75;\n  }\n  .icon {\n    color: var(--paper-item-icon-color, #44739e);\n    display: inline-block;\n    flex: 0 0 1.7em;\n    text-align: center;\n  }\n  .icon > ha-icon {\n    height: 1.7em;\n    width: 1.7em;\n  }\n  .icon[loc=\"left\"] {\n    order: -1;\n    margin-right: .6em;\n    margin-left: 0;\n  }\n  .icon[loc=\"state\"] {\n    align-self: center;\n  }\n  .states {\n    align-items: flex-start;\n    font-weight: 300;\n    justify-content: space-between;\n    flex-wrap: nowrap;\n  }\n  .states .icon {\n    align-self: center;\n    margin-left: 0;\n  }\n  .states[loc=\"center\"] {\n    justify-content: space-evenly;\n  }\n  .states[loc=\"right\"] > .state {\n    margin-left: auto;\n    order: 2;\n  }\n  .states[loc=\"center\"] .states--secondary,\n  .states[loc=\"right\"] .states--secondary {\n    margin-left: 0;\n  }\n  .states[loc=\"center\"] .states--secondary {\n    align-items: center;\n  }\n  .states[loc=\"right\"] .states--secondary {\n    align-items: flex-start;\n  }\n  .states[loc=\"center\"] .state__time {\n    left: 50%;\n    transform: translateX(-50%);\n  }\n  .states > .icon > ha-icon {\n    height: 2em !important;\n    width: 2em !important;\n  }\n  .states--secondary {\n    display: flex;\n    flex-flow: column;\n    flex-wrap: wrap;\n    align-items: flex-end;\n    margin-left: 1rem;\n    min-width: 0;\n    margin-left: 1.4em;\n  }\n  .states--secondary:empty {\n    display: none;\n  }\n  .state {\n    position: relative;\n    display: flex;\n    flex-wrap: wrap;\n    max-width: 100%;\n    min-width: 0;\n  }\n  .state--small {\n    font-size: .6em;\n    margin-bottom: .6rem;\n    flex-wrap: nowrap;\n  }\n  .state--small > svg {\n    position: absolute;\n    left: -1.6em;\n    align-self: center;\n    height: 1em;\n    width: 1em;\n    border-radius: 100%;\n    margin-right: 1em;\n  }\n  .state--small:last-child {\n    margin-bottom: 0;\n  }\n  .states--secondary > :only-child {\n    font-size: 1em;\n    margin-bottom: 0;\n  }\n  .states--secondary > :only-child svg {\n    display: none;\n  }\n  .state__value {\n    display: inline-block;\n    font-size: 2.4em;\n    line-height: 1em;\n    margin-right: .25rem;\n  }\n  .state__uom {\n    align-self: flex-end;\n    display: inline-block;\n    font-size: 1.4em;\n    font-weight: 400;\n    line-height: 1.2em;\n    margin-top: .1em;\n    opacity: .6;\n    vertical-align: bottom;\n  }\n  .state--small .state__uom {\n    flex: 1;\n  }\n  .state__time {\n    font-size: .95rem;\n    font-weight: 500;\n    bottom: -1.1rem;\n    left: 0;\n    opacity: .75;\n    position: absolute;\n    white-space: nowrap;\n  }\n  .states[loc=\"right\"] .state__time {\n    left: initial;\n    right: 0;\n  }\n  .graph {\n    align-self: flex-end;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    margin-top: auto;\n    width: 100%;\n  }\n  .graph__container {\n    display: flex;\n    flex-direction: row;\n    position: relative;\n  }\n  .graph__container__svg {\n    cursor: default;\n    flex: 1;\n  }\n  svg {\n    overflow: hidden;\n  }\n  path {\n    stroke-linecap: round;\n    stroke-linejoin: round;\n  }\n  .line--fill[anim=\"false\"] {\n    animation: reveal .25s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line--fill[anim=\"false\"][type=\"fade\"] {\n    animation: reveal-2 .25s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line--points[anim=\"false\"],\n  .line[anim=\"false\"] {\n    animation: pop .25s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line--point {\n    cursor: pointer;\n    fill: var(--paper-card-background-color, white);\n    stroke-width: inherit;\n    transition: fill .15s cubic-bezier(0.215, 0.61, 0.355, 1);\n  }\n  .line--point:hover {\n    fill: inherit;\n  }\n  .bars {\n    animation: pop .25s cubic-bezier(0.215, 0.61, 0.355, 1);\n  }\n  .bars[anim] {\n    animation: bars .5s cubic-bezier(0.215, 0.61, 0.355, 1);\n  }\n  .bar {\n    transition: opacity .25s cubic-bezier(0.215, 0.61, 0.355, 1);\n  }\n  .bar:hover {\n    opacity: .5;\n    cursor: pointer;\n  }\n  ha-card[gradient] .line--point:hover {\n    fill: var(--primary-text-color, white);\n  }\n  path,\n  .line--points,\n  .line--fill {\n    opacity: 0;\n  }\n  .line--points[anim=\"true\"][init] {\n    animation: pop .5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line--fill[anim=\"true\"][init] {\n    animation: reveal .5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line--fill[anim=\"true\"][init][type=\"fade\"] {\n    animation: reveal-2 .5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .line[anim=\"true\"][init] {\n    animation: dash 1s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;\n  }\n  .graph__labels {\n    align-items: flex-start;\n    flex-direction: column;\n    font-size: calc(.15em + 8.5px);\n    font-weight: 400;\n    justify-content: space-between;\n    margin-right: 10px;\n    padding: .6em;\n    position: absolute;\n    pointer-events: none;\n    top: 0; bottom: 0;\n    opacity: .75;\n  }\n  .graph__labels > span {\n    cursor: pointer;\n    background: var(--primary-background-color, white);\n    border-radius: 1em;\n    padding: .2em .6em;\n    box-shadow: 0 1px 3px rgba(0,0,0,.12), 0 1px 2px rgba(0,0,0,.24);\n  }\n  .graph__legend {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-evenly;\n    padding-top: 16px;\n    flex-wrap: wrap;\n  }\n  .graph__legend__item {\n    cursor: pointer;\n    display: flex;\n    min-width: 0;\n    margin: .4em;\n    align-items: center\n  }\n  .graph__legend__item span {\n    opacity: .75;\n    margin-left: .4em;\n  }\n  .graph__legend__item svg {\n    border-radius: 100%;\n  }\n  .info {\n    justify-content: space-between;\n    align-items: middle;\n  }\n  .info__item {\n    display: flex;\n    flex-flow: column;\n    align-items: flex-end;\n    text-align: right;\n  }\n  .info__item:first-child {\n    align-items: flex-start;\n    text-align: left;\n  }\n  .info__item__type {\n    text-transform: capitalize;\n    font-weight: 500;\n    opacity: .9;\n  }\n  .info__item__time,\n  .info__item__value {\n    opacity: .75;\n  }\n  .ellipsis {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  @keyframes reveal {\n    0% { opacity: 0; }\n    100% { opacity: .15; }\n  }\n  @keyframes reveal-2 {\n    0% { opacity: 0; }\n    100% { opacity: .4; }\n  }\n  @keyframes pop {\n    0% { opacity: 0; }\n    100% { opacity: 1; }\n  }\n  @keyframes bars {\n    0% { opacity: 0; }\n    50% { opacity: 0; }\n    100% { opacity: 1; }\n  }\n  @keyframes dash {\n    0% {\n      opacity: 0;\n    }\n    25% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 1;\n      stroke-dashoffset: 0;\n    }\n  }"]);return D=function(){return a},a}function E(a,b){return b||(b=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}function F(a){return I(a)||H(a)||G()}function G(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function H(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function I(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b():"function"==typeof define&&define.amd?define(b):b()})(this,function(){var I=Number.isNaN,J=Math.max,K=Math.min,L=Math.ceil,M=Math.abs;function C(a){let b=ra.get(a.type);void 0===b&&(b={stringsArray:new WeakMap,keyString:new Map},ra.set(a.type,b));let c=b.stringsArray.get(a.strings);if(void 0!==c)return c;const d=a.strings.join(U);return c=b.keyString.get(d),void 0===c&&(c=new _(a,a.getTemplateElement()),b.keyString.set(d,c)),b.stringsArray.set(a.strings,c),c}function E(a,b){const{element:{content:d},parts:c}=a,e=document.createTreeWalker(d,wa,null,!1);let f=ya(c),g=c[f],h=-1,i=0;const j=[];for(let d=null;e.nextNode();){h++;const a=e.currentNode;for(a.previousSibling===d&&(d=null),b.has(a)&&(j.push(a),null===d&&(d=a)),null!==d&&i++;g!==void 0&&g.index===h;)g.index=null===d?g.index-i:-1,f=ya(c,f),g=c[f]}j.forEach(a=>a.parentNode.removeChild(a))}function G(a,b,c=null){const{element:{content:e},parts:d}=a;if(null===c||void 0===c)return void e.appendChild(b);const f=document.createTreeWalker(e,wa,null,!1);let g=ya(d),h=0,i=-1;for(;f.nextNode();){i++;const a=f.currentNode;for(a===c&&(h=xa(b),c.parentNode.insertBefore(b,c));-1!==g&&d[g].index===i;){if(0<h){for(;-1!==g;)d[g].index+=h,g=ya(d,g);return}g=ya(d,g)}}}function H(a,b=[]){for(let c=0,d=a.length;c<d;c++){const d=a[c];Array.isArray(d)?H(d,b):b.push(d)}return b}const N=new WeakMap,O=a=>"function"==typeof a&&N.has(a),P=window.customElements!==void 0&&window.customElements.polyfillWrapFlushCallback!==void 0,Q=(a,b,c=null,d=null)=>{for(let e=b;e!==c;){const b=e.nextSibling;a.insertBefore(e,d),e=b}},R=(a,b,c=null)=>{for(let d=b;d!==c;){const b=d.nextSibling;a.removeChild(d),d=b}},S={},T={},U="{{lit-".concat((Math.random()+"").slice(2),"}}"),W="<!--".concat(U,"-->"),Z=new RegExp("".concat(U,"|").concat(W)),$="$lit$";class _{constructor(a,b){this.parts=[],this.element=b;let c=-1,d=0;const e=[],f=b=>{const g=b.content,h=document.createTreeWalker(g,133,null,!1);for(let g=0;h.nextNode();){c++;const b=h.currentNode;if(1===b.nodeType){if(b.hasAttributes()){const e=b.attributes;let f=0;for(let a=0;a<e.length;a++)0<=e[a].value.indexOf(U)&&f++;for(;0<f--;){const e=a.strings[d],f=ca.exec(e)[2],g=f.toLowerCase()+$,h=b.getAttribute(g),i=h.split(Z);this.parts.push({type:"attribute",index:c,name:f,strings:i}),b.removeAttribute(g),d+=i.length-1}}"TEMPLATE"===b.tagName&&f(b)}else if(3===b.nodeType){const a=b.data;if(0<=a.indexOf(U)){const f=b.parentNode,g=a.split(Z),h=g.length-1;for(let a=0;a<h;a++)f.insertBefore(""===g[a]?ba():document.createTextNode(g[a]),b),this.parts.push({type:"node",index:++c});""===g[h]?(f.insertBefore(ba(),b),e.push(b)):b.data=g[h],d+=h}}else if(8===b.nodeType)if(b.data===U){const a=b.parentNode;(null===b.previousSibling||c===g)&&(c++,a.insertBefore(ba(),b)),g=c,this.parts.push({type:"node",index:c}),null===b.nextSibling?b.data="":(e.push(b),c--),d++}else for(let a=-1;-1!==(a=b.data.indexOf(U,a+1));)this.parts.push({type:"node",index:-1})}};f(b);for(const c of e)c.parentNode.removeChild(c)}}const aa=a=>-1!==a.index,ba=()=>document.createComment(""),ca=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class da{constructor(a,b,c){this._parts=[],this.template=a,this.processor=b,this.options=c}update(a){let b=0;for(const c of this._parts)void 0!==c&&c.setValue(a[b]),b++;for(const b of this._parts)void 0!==b&&b.commit()}_clone(){const a=P?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),b=this.template.parts;let c=0,d=0;const e=a=>{const f=document.createTreeWalker(a,133,null,!1);for(let h=f.nextNode();c<b.length&&null!==h;){const a=b[c];if(!aa(a))this._parts.push(void 0),c++;else if(d===a.index){if("node"===a.type){const a=this.processor.handleTextExpression(this.options);a.insertAfterNode(h.previousSibling),this._parts.push(a)}else{var g;(g=this._parts).push.apply(g,F(this.processor.handleAttributeExpressions(h,a.name,a.strings,this.options)))}c++}else d++,"TEMPLATE"===h.nodeName&&e(h.content),h=f.nextNode()}};return e(a),P&&(document.adoptNode(a),customElements.upgrade(a)),a}}class ea{constructor(a,b,c,d){this.strings=a,this.values=b,this.type=c,this.processor=d}getHTML(){const a=this.strings.length-1;let b="";for(let c=0;c<a;c++){const a=this.strings[c],d=ca.exec(a);b+=d?a.substr(0,d.index)+d[1]+d[2]+$+d[3]+U:a+W}return b+this.strings[a]}getTemplateElement(){const a=document.createElement("template");return a.innerHTML=this.getHTML(),a}}class fa extends ea{getHTML(){return"<svg>".concat(super.getHTML(),"</svg>")}getTemplateElement(){const a=super.getTemplateElement(),b=a.content,c=b.firstChild;return b.removeChild(c),Q(b,c.firstChild),a}}const ga=a=>null===a||"object"!=typeof a&&"function"!=typeof a;class ha{constructor(a,b,c){this.dirty=!0,this.element=a,this.name=b,this.strings=c,this.parts=[];for(let d=0;d<c.length-1;d++)this.parts[d]=this._createPart()}_createPart(){return new ia(this)}_getValue(){const a=this.strings,b=a.length-1;let c="";for(let d=0;d<b;d++){c+=a[d];const b=this.parts[d];if(void 0!==b){const a=b.value;if(null!=a&&(Array.isArray(a)||"string"!=typeof a&&a[Symbol.iterator]))for(const b of a)c+="string"==typeof b?b:b+"";else c+="string"==typeof a?a:a+""}}return c+=a[b],c}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class ia{constructor(a){this.value=void 0,this.committer=a}setValue(a){a===S||ga(a)&&a===this.value||(this.value=a,!O(a)&&(this.committer.dirty=!0))}commit(){for(;O(this.value);){const a=this.value;this.value=S,a(this)}this.value===S||this.committer.commit()}}class ja{constructor(a){this.value=void 0,this._pendingValue=void 0,this.options=a}appendInto(a){this.startNode=a.appendChild(ba()),this.endNode=a.appendChild(ba())}insertAfterNode(a){this.startNode=a,this.endNode=a.nextSibling}appendIntoPart(a){a._insert(this.startNode=ba()),a._insert(this.endNode=ba())}insertAfterPart(a){a._insert(this.startNode=ba()),this.endNode=a.endNode,a.endNode=this.startNode}setValue(a){this._pendingValue=a}commit(){for(;O(this._pendingValue);){const a=this._pendingValue;this._pendingValue=S,a(this)}const a=this._pendingValue;a===S||(ga(a)?a!==this.value&&this._commitText(a):a instanceof ea?this._commitTemplateResult(a):a instanceof Node?this._commitNode(a):Array.isArray(a)||a[Symbol.iterator]?this._commitIterable(a):a===T?(this.value=T,this.clear()):this._commitText(a))}_insert(a){this.endNode.parentNode.insertBefore(a,this.endNode)}_commitNode(a){this.value===a||(this.clear(),this._insert(a),this.value=a)}_commitText(a){const b=this.startNode.nextSibling;a=null==a?"":a,b===this.endNode.previousSibling&&3===b.nodeType?b.data=a:this._commitNode(document.createTextNode("string"==typeof a?a:a+"")),this.value=a}_commitTemplateResult(a){const b=this.options.templateFactory(a);if(this.value instanceof da&&this.value.template===b)this.value.update(a.values);else{const c=new da(b,a.processor,this.options),d=c._clone();c.update(a.values),this._commitNode(d),this.value=c}}_commitIterable(a){Array.isArray(this.value)||(this.value=[],this.clear());const b=this.value;let c,d=0;for(const e of a)c=b[d],void 0===c&&(c=new ja(this.options),b.push(c),0==d?c.appendIntoPart(this):c.insertAfterPart(b[d-1])),c.setValue(e),c.commit(),d++;d<b.length&&(b.length=d,this.clear(c&&c.endNode))}clear(a=this.startNode){R(this.startNode.parentNode,a.nextSibling,this.endNode)}}class ka{constructor(a,b,c){if(this.value=void 0,this._pendingValue=void 0,2!==c.length||""!==c[0]||""!==c[1])throw new Error("Boolean attributes can only contain a single expression");this.element=a,this.name=b,this.strings=c}setValue(a){this._pendingValue=a}commit(){for(;O(this._pendingValue);){const a=this._pendingValue;this._pendingValue=S,a(this)}if(this._pendingValue!==S){const a=!!this._pendingValue;this.value!==a&&(a?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=a,this._pendingValue=S}}}class la extends ha{constructor(a,b,c){super(a,b,c),this.single=2===c.length&&""===c[0]&&""===c[1]}_createPart(){return new ma(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class ma extends ia{}let na=!1;try{const a={get capture(){return na=!0,!1}};window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch(a){}class oa{constructor(a,b,c){this.value=void 0,this._pendingValue=void 0,this.element=a,this.eventName=b,this.eventContext=c,this._boundHandleEvent=a=>this.handleEvent(a)}setValue(a){this._pendingValue=a}commit(){for(;O(this._pendingValue);){const a=this._pendingValue;this._pendingValue=S,a(this)}if(this._pendingValue===S)return;const a=this._pendingValue,b=this.value,c=null==a||null!=b&&(a.capture!==b.capture||a.once!==b.once||a.passive!==b.passive);c&&this.element.removeEventListener(this.eventName,this._boundHandleEvent,this._options),null!=a&&(null==b||c)&&(this._options=pa(a),this.element.addEventListener(this.eventName,this._boundHandleEvent,this._options)),this.value=a,this._pendingValue=S}handleEvent(a){"function"==typeof this.value?this.value.call(this.eventContext||this.element,a):this.value.handleEvent(a)}}const pa=a=>a&&(na?{capture:a.capture,passive:a.passive,once:a.once}:a.capture);const qa=new class{handleAttributeExpressions(a,b,c,d){const e=b[0];if("."===e){const d=new la(a,b.slice(1),c);return d.parts}if("@"===e)return[new oa(a,b.slice(1),d.eventContext)];if("?"===e)return[new ka(a,b.slice(1),c)];const f=new ha(a,b,c);return f.parts}handleTextExpression(a){return new ja(a)}},ra=new Map,sa=new WeakMap,ta=(a,b,c)=>{let d=sa.get(b);d===void 0&&(R(b,b.firstChild),sa.set(b,d=new ja(Object.assign({templateFactory:C},c))),d.appendInto(b)),d.setValue(a),d.commit()};(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.0.0");const ua=(a,...b)=>new ea(a,b,"html",qa),va=(a,...b)=>new fa(a,b,"svg",qa),wa=133,xa=a=>{let b=11===a.nodeType?0:1;for(const c=document.createTreeWalker(a,wa,null,!1);c.nextNode();)b++;return b},ya=(a,b=-1)=>{for(let c=b+1;c<a.length;c++){const b=a[c];if(aa(b))return c}return-1},za=(a,b)=>"".concat(a,"--").concat(b);let Aa=!0;"undefined"==typeof window.ShadyCSS?Aa=!1:"undefined"==typeof window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected.Please update to at least @webcomponents/webcomponentsjs@2.0.2 and@webcomponents/shadycss@1.3.1."),Aa=!1);const Ba=a=>b=>{const c=za(b.type,a);let d=ra.get(c);void 0===d&&(d={stringsArray:new WeakMap,keyString:new Map},ra.set(c,d));let e=d.stringsArray.get(b.strings);if(void 0!==e)return e;const f=b.strings.join(U);if(e=d.keyString.get(f),void 0===e){const c=b.getTemplateElement();Aa&&window.ShadyCSS.prepareTemplateDom(c,a),e=new _(b,c),d.keyString.set(f,e)}return d.stringsArray.set(b.strings,e),e},Ca=["html","svg"],Da=a=>{Ca.forEach(b=>{const c=ra.get(za(b,a));c!==void 0&&c.keyString.forEach(a=>{const{element:{content:b}}=a,c=new Set;Array.from(b.querySelectorAll("style")).forEach(a=>{c.add(a)}),E(a,c)})})},Ea=new Set,Fa=(a,b,c)=>{Ea.add(c);const d=a.querySelectorAll("style");if(0===d.length)return void window.ShadyCSS.prepareTemplateStyles(b.element,c);const e=document.createElement("style");for(let f=0;f<d.length;f++){const a=d[f];a.parentNode.removeChild(a),e.textContent+=a.textContent}if(Da(c),G(b,e,b.element.content.firstChild),window.ShadyCSS.prepareTemplateStyles(b.element,c),window.ShadyCSS.nativeShadow){const c=b.element.content.querySelector("style");a.insertBefore(c.cloneNode(!0),a.firstChild)}else{b.element.content.insertBefore(e,b.element.content.firstChild);const a=new Set;a.add(e),E(b,a)}},Ga=(a,b,c)=>{const d=c.scopeName,e=sa.has(b),f=b instanceof ShadowRoot&&Aa&&a instanceof ea,g=f&&!Ea.has(d),h=g?document.createDocumentFragment():b;if(ta(a,h,Object.assign({templateFactory:Ba(d)},c)),g){const a=sa.get(h);sa.delete(h),a.value instanceof da&&Fa(h,a.value.template,d),R(b,b.firstChild),b.appendChild(h),sa.set(b,a)}!e&&f&&window.ShadyCSS.styleElement(b.host)};window.JSCompiler_renameProperty=a=>a;const Ha={toAttribute(a,b){return b===Boolean?a?"":null:b===Object||b===Array?null==a?a:JSON.stringify(a):a},fromAttribute(a,b){return b===Boolean?null!==a:b===Number?null===a?null:+a:b===Object||b===Array?JSON.parse(a):a}},Ia=(a,b)=>b!==a&&(b===b||a===a),Ja={attribute:!0,type:String,converter:Ha,reflect:!1,hasChanged:Ia},Ka=Promise.resolve(!0),La=1,Ma=4,Na=8,Oa=16,Pa=32;class Qa extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=Ka,this._hasConnectedResolver=void 0,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const a=[];return this._classProperties.forEach((b,c)=>{const d=this._attributeNameForProperty(c,b);void 0!==d&&(this._attributeToPropertyMap.set(d,c),a.push(d))}),a}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const a=Object.getPrototypeOf(this)._classProperties;a!==void 0&&a.forEach((a,b)=>this._classProperties.set(b,a))}}static createProperty(a,b=Ja){if(this._ensureClassProperties(),this._classProperties.set(a,b),b.noAccessor||this.prototype.hasOwnProperty(a))return;const c="symbol"==typeof a?Symbol():"__".concat(a);Object.defineProperty(this.prototype,a,{get(){return this[c]},set(b){const d=this[a];this[c]=b,this._requestUpdate(a,d)},configurable:!0,enumerable:!0})}static finalize(){if(!(this.hasOwnProperty(JSCompiler_renameProperty("finalized",this))&&this.finalized)){const a=Object.getPrototypeOf(this);if("function"==typeof a.finalize&&a.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const a=this.properties,b=[].concat(F(Object.getOwnPropertyNames(a)),F("function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(a):[]));for(const c of b)this.createProperty(c,a[c])}}}static _attributeNameForProperty(a,b){const c=b.attribute;return!1===c?void 0:"string"==typeof c?c:"string"==typeof a?a.toLowerCase():void 0}static _valueHasChanged(a,b,c=Ia){return c(a,b)}static _propertyValueFromAttribute(a,b){const c=b.type,d=b.converter||Ha,e="function"==typeof d?d:d.fromAttribute;return e?e(a,c):a}static _propertyValueToAttribute(a,b){if(void 0===b.reflect)return;const c=b.type,d=b.converter,e=d&&d.toAttribute||Ha.toAttribute;return e(a,c)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((a,b)=>{if(this.hasOwnProperty(b)){const a=this[b];delete this[b],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(b,a)}})}_applyInstanceProperties(){this._instanceProperties.forEach((a,b)=>this[b]=a),this._instanceProperties=void 0}connectedCallback(){this._updateState|=Pa,this._hasConnectedResolver&&(this._hasConnectedResolver(),this._hasConnectedResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(a,b,c){b!==c&&this._attributeToProperty(a,c)}_propertyToAttribute(a,b,c=Ja){const d=this.constructor,e=d._attributeNameForProperty(a,c);if(e!==void 0){const a=d._propertyValueToAttribute(b,c);if(a===void 0)return;this._updateState|=Na,null==a?this.removeAttribute(e):this.setAttribute(e,a),this._updateState&=~Na}}_attributeToProperty(a,b){if(this._updateState&Na)return;const c=this.constructor,d=c._attributeToPropertyMap.get(a);if(d!==void 0){const a=c._classProperties.get(d)||Ja;this._updateState|=Oa,this[d]=c._propertyValueFromAttribute(b,a),this._updateState&=~Oa}}_requestUpdate(a,b){let c=!0;if(a!==void 0){const d=this.constructor,e=d._classProperties.get(a)||Ja;d._valueHasChanged(this[a],b,e.hasChanged)?(!this._changedProperties.has(a)&&this._changedProperties.set(a,b),!0===e.reflect&&!(this._updateState&Oa)&&(this._reflectingProperties===void 0&&(this._reflectingProperties=new Map),this._reflectingProperties.set(a,e))):c=!1}!this._hasRequestedUpdate&&c&&this._enqueueUpdate()}requestUpdate(a,b){return this._requestUpdate(a,b),this.updateComplete}async _enqueueUpdate(){this._updateState|=Ma;let a,b;const c=this._updatePromise;this._updatePromise=new Promise((c,d)=>{a=c,b=d});try{await c}catch(a){}this._hasConnected||(await new Promise(a=>this._hasConnectedResolver=a));try{const a=this.performUpdate();null!=a&&(await a)}catch(a){b(a)}a(!this._hasRequestedUpdate)}get _hasConnected(){return this._updateState&Pa}get _hasRequestedUpdate(){return this._updateState&Ma}get hasUpdated(){return this._updateState&La}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let a=!1;const b=this._changedProperties;try{a=this.shouldUpdate(b),a&&this.update(b)}catch(b){throw a=!1,b}finally{this._markUpdated()}a&&(!(this._updateState&La)&&(this._updateState|=La,this.firstUpdated(b)),this.updated(b))}_markUpdated(){this._changedProperties=new Map,this._updateState&=~Ma}get updateComplete(){return this._updatePromise}shouldUpdate(a){return!0}update(a){this._reflectingProperties!==void 0&&0<this._reflectingProperties.size&&(this._reflectingProperties.forEach((a,b)=>this._propertyToAttribute(b,this[b],a)),this._reflectingProperties=void 0)}updated(a){}firstUpdated(a){}}Qa.finalized=!0;const Ra="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Sa=Symbol();class Ta{constructor(a,b){if(b!==Sa)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=a}get styleSheet(){return void 0===this._styleSheet&&(Ra?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const Ua=a=>{if(a instanceof Ta)return a.cssText;throw new Error("Value passed to 'css' function must be a 'css' function result: ".concat(a,". Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security."))};(window.litElementVersions||(window.litElementVersions=[])).push("2.0.1");const Va=a=>a.flat?a.flat(1/0):H(a);class Wa extends Qa{static finalize(){super.finalize(),this._styles=this.hasOwnProperty(JSCompiler_renameProperty("styles",this))?this._getUniqueStyles():this._styles||[]}static _getUniqueStyles(){const a=this.styles,b=[];if(Array.isArray(a)){const c=Va(a),d=c.reduceRight((a,b)=>(a.add(b),a),new Set);d.forEach(a=>b.unshift(a))}else a&&b.push(a);return b}initialize(){super.initialize(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const a=this.constructor._styles;0===a.length||(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow?Ra?this.renderRoot.adoptedStyleSheets=a.map(a=>a.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(a.map(a=>a.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&window.ShadyCSS!==void 0&&window.ShadyCSS.styleElement(this)}update(a){super.update(a);const b=this.render();b instanceof ea&&this.constructor.render(b,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(a=>{const b=document.createElement("style");b.textContent=a.cssText,this.renderRoot.appendChild(b)}))}render(){}}Wa.finalized=!0,Wa.render=Ga;const Xa="https://github.com/kalkih/mini-graph-card/blob/master/README.md",Ya="mcg-history",Za=14,$a=96,_a={humidity:"hass:water-percent",illuminance:"hass:brightness-5",temperature:"hass:thermometer",battery:"hass:battery"},ab=["var(--accent-color)","#3498db","#e74c3c","#9b59b6","#f1c40f","#2ecc71"],bb=["entity","line","length","fill","points","tooltip","abs"],cb={name:!0,icon:!0,state:!0,graph:"line",labels:"hover",extrema:!1,legend:!0,fill:!0,points:"hover"},db=0,X=1,Y=2;class V{constructor(a,b,c,d=24,e=1){this.coords=[],this.width=a-2*c[db],this.height=b-2*c[X],this.margin=c,this._max=0,this._min=0,this.points=e,this.hours=d}get max(){return this._max}set max(a){this._max=a}get min(){return this._min}set min(a){this._min=a}update(a){const b=new Date().getTime(),c=(a,c)=>{var d=Math.floor;const e=b-new Date(c.last_changed).getTime(),f=e/3600000*this.points-this.hours*this.points,g=d(M(f));return a[g]||(a[g]=[]),a[g].push(c),a},d=a.reduce((a,b)=>c(a,b),[]);d.length=L(this.hours*this.points),this.coords=this._calcPoints(d),this.min=K.apply(Math,F(this.coords.map(a=>+a[Y]))),this.max=J.apply(Math,F(this.coords.map(a=>+a[Y])))}_calcPoints(a){var b=Number.isFinite;const c=[];let d=this.width/(this.hours*this.points-1);d=b(d)?d:this.width;const e=a.filter(Boolean)[0];let f=[this._average(e),this._last(e)];const g=(a,b)=>{const e=d*b+this.margin[db];return a&&(f=[this._average(a),this._last(a)]),c.push([e,0,a?f[0]:f[1]])};for(let b=0;b<a.length;b+=1)g(a[b],b);return 1===c.length&&(c[1]=[this.width+this.margin[db],0,c[0][Y]]),c}_calcY(a){const b=(this.max-this.min)/this.height||1;return a.map(a=>[a[db],this.height-(a[Y]-this.min)/b+1*this.margin[X],a[Y]])}getPoints(){const a=this._calcY(this.coords);let b,c,d=a[0];a.shift();const e=a.map((a,e)=>{b=a,c=this._midPoint(d[db],d[X],b[db],b[X]);const f=(b[Y]+d[Y])/2;return d=b,[c[db],c[X],f,e+1]});return e}getPath(){const a=this._calcY(this.coords);let b,c,d="",e=a[0];return d+="M".concat(e[db],",").concat(e[X]),a.forEach(a=>{b=a,c=this._midPoint(e[db],e[X],b[db],b[X]),d+=" ".concat(c[db],",").concat(c[X]),d+=" Q ".concat(b[db],",").concat(b[X]),e=b}),d+=" ".concat(b[db],",").concat(b[X]),d}computeGradient(a){const b=this._max-this._min;return a.filter(a=>a.value>this._min&&a.value<this._max).map(a=>({color:a.color,offset:100-100*(a.value/b)}))}getFill(a){const b=this.height+2*this.margin[X];let c=a;return c+=" L ".concat(this.width-2*this.margin[db],", ").concat(b),c+=" L ".concat(this.coords[0][db],", ").concat(b," z"),c}getBars(a,b){const c=this._calcY(this.coords),d=4,e=(this.width-d)/L(this.hours*this.points)/b;return c.map((c,f)=>({x:e*f*b+e*a+d,y:c[X],height:this.height-c[X]+3*this.margin[X],width:e-d,value:c[Y]}))}_midPoint(a,b,c,d){return[(a-c)/2+c,(b-d)/2+d]}_average(a){return a.reduce((a,b)=>a+parseFloat(b.state),0)/a.length}_last(a){return parseFloat(a[a.length-1].state)||0}}const eb=((a,...b)=>{const c=b.reduce((b,c,d)=>b+Ua(c)+a[d+1],a[0]);return new Ta(c,Sa)})(D()),fb=(a,b)=>a.reduce((a,c)=>+c[b]<+a[b]?c:a,a[0]),gb=(a,b)=>a.reduce((a,c)=>+c[b]>+a[b]?c:a,a[0]),hb=(a,b,c="en-US")=>a.toLocaleString(c,B({hour:"numeric",minute:"numeric"},b)),ib=a=>a*3600*1000,jb=window.localStorage||{};class kb extends Wa{constructor(){super(),this.id=Math.random().toString(36).substr(2,9),this.bound=[0,0],this.abs=[],this.length=[],this.entity=[],this.line=[],this.bar=[],this.fill=[],this.points=[],this.gradient=[],this.tooltip={},this.updateQueue=[],this.updating=!1,this.stateChanged=!1}static get styles(){return eb}set hass(a){this._hass=a;let b=!1;this.config.entities.forEach((c,d)=>{const e=a.states[c.entity];e&&this.entity[d]!==e&&(this.entity[d]=e,this.updateQueue.push(e.entity_id),b=!0)}),b&&(this.entity=F(this.entity),this.config.update_interval||this.updating?this.stateChanged=!0:this.updateData())}static get properties(){return{id:String,_hass:{},config:{},entity:[],Graph:[],line:[],shadow:[],length:Number,bound:[],abs:[],tooltip:{},updateQueue:[],color:String}}setConfig(a){if(a.entity)throw new Error("The \"entity\" option was removed, please use \"entities\".\n See ".concat(Xa));if(!Array.isArray(a.entities))throw new Error("Please provide the \"entities\" option as a list.\n See ".concat(Xa));if(a.line_color_above||a.line_color_below)throw new Error("\"line_color_above/line_color_below\" was removed, please use \"color_thresholds\".\n See ".concat(Xa));const b=B({animate:!1,hour24:!1,font_size:Za,font_size_header:14,height:100,hours_to_show:24,points_per_hour:.5,line_color:[].concat(ab),color_thresholds:[],line_width:5,more_info:!0},a,{show:B({},cb,a.show)});b.entities.forEach((a,c)=>{"string"==typeof a&&(b.entities[c]={entity:a})}),"string"==typeof a.line_color&&(b.line_color=[a.line_color].concat(ab)),b.font_size=a.font_size/100*Za||Za,b.color_thresholds.sort((c,a)=>a.value-c.value);const c=24<b.hours_to_show?{day:"numeric",weekday:"short"}:{};if(b.format=B({hour12:!b.hour24},c),"bar"===b.show.graph){const a=b.entities.length;b.hours_to_show*b.points_per_hour*a>$a&&(b.points_per_hour=$a/(b.hours_to_show*a),console.warn("mini-graph-card: Not enough space, adjusting points_per_hour to ",b.points_per_hour))}this.Graph||(this.Graph=b.entities.map(()=>new V(500,b.height,[b.show.fill?0:b.line_width,b.line_width],b.hours_to_show,b.points_per_hour))),this.config=b}connectedCallback(){super.connectedCallback(),this.config.update_interval&&(this.updateOnInterval(),this.interval=setInterval(()=>this.updateOnInterval(),1e3*this.config.update_interval))}disconnectedCallback(){this.interval&&clearInterval(this.interval),super.disconnectedCallback()}shouldUpdate(a){return!!this.entity[0]&&(bb.some(b=>a.has(b))?(this.color=this.computeColor(this.tooltip.value||this.entity[0].state,this.tooltip.entity||0),!0):void 0)}updated(a){this.config.animate&&a.has("line")&&(this.length.length<this.entity.length?(this.shadowRoot.querySelectorAll("svg path.line").forEach(a=>{this.length[a.id]=a.getTotalLength()}),this.length=F(this.length)):this.length=Array(this.entity.length).fill("none"))}render({config:a}=this){return ua(A(),a.group,a.show.graph&&a.show.fill,"hover"===a.show.points,"hover"===a.show.labels,0<a.color_thresholds.length,a.more_info,a.font_size,a=>this.handlePopup(a,this.entity[0]),this.renderHeader(),this.renderStates(),this.renderGraph(),this.renderInfo())}renderHeader(){const{show:a,align_icon:b,align_header:c,font_size_header:d}=this.config;return a.name||a.icon&&"state"!==b?ua(z(),c,d,this.renderName(),"state"===b?"":this.renderIcon()):""}renderIcon(){const{icon:a,icon_adaptive_color:b}=this.config.show;return a?ua(y(),this.config.align_icon,b?"color: ".concat(this.color,";"):"",this.computeIcon(this.entity[0])):""}renderName(){if(!this.config.show.name)return;const a=this.tooltip.entity===void 0?this.config.name||this.computeName(0):this.computeName(this.tooltip.entity),b=this.config.show.name_adaptive_color?"opacity: 1; color: ".concat(this.color,";"):"";return ua(x(),b,a)}renderStates(){const{entity:a,value:b}=this.tooltip,c=b===void 0?this.entity[0].state:b,d=this.config.entities[0].state_adaptive_color?"color: ".concat(this.color,";"):"";if(this.config.show.state)return ua(w(),this.config.align_state,d,this.computeState(c),d,this.computeUom(a||0),this.renderStateTime(),this.config.entities.map((a,b)=>this.renderState(a,b)),"state"===this.config.align_icon?this.renderIcon():"")}renderState(a,b){if(a.show_state&&0!==b){const{state:c}=this.entity[b];return ua(v(),a.state_adaptive_color?"color: ".concat(this.computeColor(c,b),";"):"",a.show_indicator?this.renderIndicator(c,b):"",this.computeState(c),this.computeUom(b))}}renderStateTime(){return void 0===this.tooltip.value?void 0:ua(u(),this.tooltip.time[0],this.tooltip.time[1])}renderGraph(){return this.config.show.graph?ua(t(),this.renderLabels(),this.renderSvg(),this.renderLegend()):""}renderLegend(){return 1>=this.config.entities.length||!this.config.show.legend?void 0:ua(s(),this.entity.map((a,b)=>ua(r(),b=>this.handlePopup(b,a),this.renderIndicator(a.state,b),this.computeName(b))))}renderIndicator(a,b){return va(q(),this.computeColor(a,b))}renderSvgFill(a,b){if(!a)return;const c=this.computeColor(this.entity[b].state,b),d="fade"===this.config.show.fill,e=d?"url(#fill-grad-".concat(this.id,"-").concat(b,")"):c;return va(p(),"fill-grad-".concat(this.id,"-").concat(b),c,c,this.config.show.fill,b,this.config.animate,this.length[b],this.config.animate?"".concat(.5*b,"s"):"0s",e,e,this.config.line_width,this.fill[b])}renderSvgLine(a,b){if(a){const a=va(o(),b,this.config.animate,this.length[b],this.config.animate?"".concat(.5*b,"s"):"0s",this.length[b]||"none",this.length[b]||"none","white",this.config.line_width,this.line[b]);return va(n(),"line-".concat(this.id,"-").concat(b),a)}}renderSvgPoints(a,b){if(a){const c=this.computeColor(this.entity[b].state,b);return va(m(),this.length[b],this.config.animate&&"hover"!==this.config.show.points,this.config.animate?"".concat(.5*b+.5,"s"):"0s",c,c,this.config.line_width/2,a.map(a=>va(l(),this.gradient[b]?this.computeColor(a[Y],b):"inherit",this.gradient[b]?this.computeColor(a[Y],b):"inherit",a[db],a[X],this.config.line_width,()=>this.setTooltip(b,a[3],a[Y]),()=>this.tooltip={})))}}renderSvgGradient(a){if(a){const b=a.map((a,b)=>a?va(k(),"grad-".concat(this.id,"-").concat(b),a.map(a=>va(j(),a.color,"".concat(a.offset,"%")))):void 0);return va(i(),b)}}renderSvgRect(a,b){if(a){const a=this.gradient[b]?"url(#grad-".concat(this.id,"-").concat(b,")"):this.computeColor(this.entity[b].state,b);return va(h(),"rect-".concat(this.id,"-").concat(b),a,"url(#line-".concat(this.id,"-").concat(b,")"))}}renderSvgBars(a,b){if(a){const c=a.map((a,c)=>{const d=this.config.animate?va(g(),this.config.height,a.y):"",e=this.computeColor(a.value,b);return va(f(),a.x,a.y,a.height,a.width,e,()=>this.setTooltip(b,c,a.value),()=>this.tooltip={},d)});return va(e(),this.config.animate,c)}}renderSvg(){const{height:a}=this.config;return va(d(),0===a?0:"100%",a,a=>a.stopPropagation(),this.renderSvgGradient(this.gradient),this.line.map((a,b)=>this.renderSvgLine(a,b)),this.fill.map((a,b)=>this.renderSvgFill(a,b)),this.line.map((a,b)=>this.renderSvgRect(a,b)),this.bar.map((a,b)=>this.renderSvgBars(a,b)),this.points.map((a,b)=>this.renderSvgPoints(a,b)))}setTooltip(a,b,c){const{points_per_hour:d,hours_to_show:e,format:f}=this.config,g=1>e&&1>d?d*e:1/d,h=M(b+1-L(e*d)),i=new Date;i.setMilliseconds(i.getMilliseconds()-ib(g*h));const j=hb(i,{hour12:!this.config.hour24},this._hass.language);i.setMilliseconds(i.getMilliseconds()-ib(g));const k=hb(i,f,this._hass.language);this.tooltip={value:c,id:h,entity:a,time:[k,j]}}renderLabels(){return this.config.show.labels?ua(c(),this.computeState(this.bound[1]),this.computeState(this.bound[0])):void 0}renderInfo(){return this.config.show.extrema?ua(b(),this.abs.map(b=>ua(a(),b.type,this.computeState(b.state),this.computeUom(0),hb(new Date(b.last_changed),this.config.format,this._hass.language)))):void 0}handlePopup(a,b){a.stopPropagation(),this.config.more_info&&this.fire("hass-more-info",{entityId:b.entity_id})}fire(a,b,c){const d=c||{},f=null===b||void 0===b?{}:b,g=new Event(a,{bubbles:void 0===d.bubbles||d.bubbles,cancelable:!!d.cancelable,composed:void 0===d.composed||d.composed});return g.detail=f,this.dispatchEvent(g),g}computeColor(a,b){const{color_thresholds:c,line_color:d}=this.config,e=B({color:d[b]||d[0]},c.slice(-1)[0],c.find(b=>b.value<(+a||0)));return this.config.entities[b].color||e.color}computeName(a){return this.config.entities[a].name||this.entity[a].attributes.friendly_name}computeIcon(a){return this.config.icon||a.attributes.icon||_a[a.attributes.device_class]||_a.temperature}computeUom(a){return this.config.entities[a].unit||this.config.unit||this.entity[a].attributes.unit_of_measurement||""}computeState(a){var b=Math.round;const c=+a,d=this.config.decimals;if(d===void 0||I(d)||I(c))return b(100*c)/100;const e=10**d;return(b(c*e)/e).toFixed(d)}updateOnInterval(){this.stateChanged&&!this.updating&&(this.stateChanged=!1,this.updateData())}async updateData({config:a}=this){this.updating=!0;const b=new Date,c=new Date;c.setMilliseconds(b.getMilliseconds()-ib(a.hours_to_show));try{const a=this.entity.map((a,d)=>this.updateEntity(a,d,c,b));await Promise.all(a)}finally{this.updating=!1}this.updateQueue=[],this.bound=[a.lower_bound===void 0?K.apply(Math,F(this.Graph.map(a=>a.min)))||this.bound[0]:a.lower_bound,a.upper_bound===void 0?J.apply(Math,F(this.Graph.map(a=>a.max)))||this.bound[1]:a.upper_bound],a.show.graph&&(this.entity.forEach((b,c)=>{b&&0!==this.Graph[c].coords.length&&([this.Graph[c].min,this.Graph[c].max]=[this.bound[0],this.bound[1]],"bar"===a.show.graph?this.bar[c]=this.Graph[c].getBars(c,a.entities.length):(this.line[c]=this.Graph[c].getPath(),a.show.fill&&(this.fill[c]=this.Graph[c].getFill(this.line[c])),a.show.points&&(this.points[c]=this.Graph[c].getPoints()),0<a.color_thresholds.length&&!a.entities[c].color&&(this.gradient[c]=this.Graph[c].computeGradient(a.color_thresholds))))}),this.line=F(this.line))}async updateEntity(a,b,c,d){if(!a||!this.updateQueue.includes(a.entity_id))return;let e=[],f=c,g=!1,h=jb[Ya]?JSON.parse(jb[Ya]):void 0;if(h&&h[a.entity_id]&&h[a.entity_id].hours_to_show===this.config.hours_to_show){e=h[a.entity_id].data,e=e.filter(a=>new Date(a.last_updated)>c),0<e.length&&(g=!0);const b=new Date(h[a.entity_id].last_fetched);b>f&&(f=new Date(b-1))}let i=await this.fetchRecent(a.entity_id,f,d,g);i[0]&&0<i[0].length&&(i=i[0].filter(a=>!I(parseFloat(a.state))),e=[].concat(F(e),F(i)),h=jb[Ya]?JSON.parse(jb[Ya]):{},h[a.entity_id]={hours_to_show:this.config.hours_to_show,last_fetched:d,data:e},jb[Ya]=JSON.stringify(h));0===e.length||(a.entity_id===this.entity[0].entity_id&&(this.abs=[B({type:"min"},fb(e,"state")),B({type:"max"},gb(e,"state"))]),this.Graph[b].update(e))}async fetchRecent(a,b,c,d){let e="history/period";return b&&(e+="/".concat(b.toISOString())),e+="?filter_entity_id=".concat(a),c&&(e+="&end_time=".concat(c.toISOString())),d&&(e+="&skip_initial_state"),this._hass.callApi("GET",e)}getCardSize(){return 3}}customElements.define("mini-graph-card",kb)})})();
